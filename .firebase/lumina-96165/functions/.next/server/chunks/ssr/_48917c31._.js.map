{"version":3,"sources":["../../../../src/app/actions/auth.ts","../../../../.next-internal/server/app/student/courses/%5BcourseId%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["'use server';\n\nimport {\n    createUserWithEmailAndPassword,\n    signInWithEmailAndPassword,\n    UserCredential\n} from 'firebase/auth';\nimport { auth } from '@/lib/firebase-config';\nimport {\n    COLLECTIONS,\n    createDocument,\n    findDocumentByField,\n    updateDocument\n} from '@/lib/firebase';\nimport { User } from '@/lib/api';\n\n/**\n * Authenticate user with Firebase Auth\n * @param email User email\n * @param password User password\n * @returns User object or null if authentication fails\n */\nexport async function authenticateUser(email: string, password: string): Promise<User | null> {\n    try {\n        // Sign in with Firebase Auth\n        const userCredential: UserCredential = await signInWithEmailAndPassword(auth, email, password);\n        const firebaseUser = userCredential.user;\n\n        if (!firebaseUser) {\n            console.log('Firebase authentication failed');\n            return null;\n        }\n\n        // Fetch user profile from Firestore\n        const userProfile = await findDocumentByField<User>(\n            COLLECTIONS.USERS,\n            'email',\n            email\n        );\n\n        if (!userProfile) {\n            console.log('User profile not found in Firestore');\n            return null;\n        }\n\n        // Return user object without sensitive data\n        return {\n            id: userProfile.id,\n            email: userProfile.email,\n            name: userProfile.name,\n            role: userProfile.role,\n            avatar: userProfile.avatar,\n            status: userProfile.status,\n            createdAt: userProfile.createdAt\n        } as User;\n\n    } catch (error: any) {\n        console.error('Authentication error:', error.code, error.message);\n        return null;\n    }\n}\n\n/**\n * Register a new user with Firebase Auth\n * @param userData User registration data\n * @returns User object or error\n */\nexport async function registerUser(userData: Partial<User> & { password: string }): Promise<User | { error: string }> {\n    try {\n        // Check if user already exists in Firestore\n        const existingUser = await findDocumentByField(\n            COLLECTIONS.USERS,\n            'email',\n            userData.email\n        );\n\n        if (existingUser) {\n            return { error: 'User already exists' };\n        }\n\n        // Create user in Firebase Auth\n        const userCredential: UserCredential = await createUserWithEmailAndPassword(\n            auth,\n            userData.email!,\n            userData.password\n        );\n\n        const firebaseUser = userCredential.user;\n\n        if (!firebaseUser) {\n            return { error: 'Failed to create Firebase user' };\n        }\n\n        // Prepare user profile for Firestore\n        const newUserProfile = {\n            email: userData.email,\n            name: userData.name || 'New User',\n            role: userData.role || 'student',\n            avatar: userData.avatar || `https://ui-avatars.com/api/?name=${encodeURIComponent(userData.name || 'User')}&background=random`,\n            status: 'active',\n            createdAt: new Date().toISOString(),\n            bio: userData.bio || '',\n            skills: userData.skills || [],\n            location: userData.location || ''\n        };\n\n        // Store user profile in Firestore using Firebase UID as document ID\n        const result = await createDocument(\n            COLLECTIONS.USERS,\n            newUserProfile,\n            firebaseUser.uid\n        );\n\n        if (!result.success) {\n            return { error: 'Failed to create user profile' };\n        }\n\n        return {\n            id: firebaseUser.uid,\n            ...newUserProfile\n        } as User;\n\n    } catch (error: any) {\n        console.error('Registration error:', error.code, error.message);\n\n        // Handle specific Firebase errors\n        if (error.code === 'auth/email-already-in-use') {\n            return { error: 'Email already in use' };\n        } else if (error.code === 'auth/invalid-email') {\n            return { error: 'Invalid email address' };\n        } else if (error.code === 'auth/weak-password') {\n            return { error: 'Password is too weak' };\n        }\n\n        return { error: 'Internal server error' };\n    }\n}\n","export {authenticateUser as '605ac65cc9dfbd23e44503660fc81311bf8a41eed3'} from 'ACTIONS_MODULE0'\nexport {registerUser as '40651031abfa44b68323c9e345cde1dcb1af6be20c'} from 'ACTIONS_MODULE0'\nexport {getStudentDashboard as '40057ca4bcb688404fffb4782f9cbc69af4eb8305d'} from 'ACTIONS_MODULE1'\nexport {getEnrolledCourses as '406484041abc913ae582429b5d7a9c61d77fec10a7'} from 'ACTIONS_MODULE1'\nexport {getAllCourses as '0026e377043794c93f675b5a76f529fcb859d7f217'} from 'ACTIONS_MODULE1'\nexport {enrollInCourse as '609a30219fe71916d39270a52f0fc832fef210e21c'} from 'ACTIONS_MODULE1'\nexport {getStudentProfile as '40d383ae01c630cc494f3b811c6cd2b06bfa5fb762'} from 'ACTIONS_MODULE1'\nexport {updateStudentProfile as '6066bf89fc45fa9dc1943a8f259b721cce7bce5191'} from 'ACTIONS_MODULE1'\nexport {getStudentProgress as '40805ef5cf85030395b16be83b6f6c01d33cd46481'} from 'ACTIONS_MODULE1'\nexport {getCommunityData as '403d4edd74f2167be9045f8e515c1a70876aaee3c7'} from 'ACTIONS_MODULE1'\nexport {getTeacherDashboard as '40f5ffabd97e9c51ae7abbfb39628e384f093144c3'} from 'ACTIONS_MODULE1'\nexport {getTeacherStudents as '401337c47da689ae5e8169cc1907bca1bd2e816ba4'} from 'ACTIONS_MODULE1'\nexport {getTeacherCourses as '40d714b0a8699ee40cacaf7d2139ef5a5e865fd473'} from 'ACTIONS_MODULE1'\nexport {createCourse as '6084225d49e62342930cf057a388710203ebd8089a'} from 'ACTIONS_MODULE1'\nexport {inviteStudentToCourse as '702795c988fb1b2fe4bd9c8f906f51e44070c39a48'} from 'ACTIONS_MODULE1'\nexport {addModule as '70c829dbdf0c5b70a5eb20982d65ac7f4d9c98e0f5'} from 'ACTIONS_MODULE1'\nexport {addLesson as '78f1f8e1fdd3c442cd07ae16d0c95036d0923c7644'} from 'ACTIONS_MODULE1'\nexport {getAdminDashboard as '408bec885feee32d80532fa2c5dacbe5aa7aefd546'} from 'ACTIONS_MODULE1'\nexport {getUsersForAdmin as '008bef5d45ec060a75a79a8b1854ed3bf6c9c82dcc'} from 'ACTIONS_MODULE1'\nexport {getCourseDetails as '40f2122612645433d209903a0a67ee199a8e8e79ef'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"wDAEA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAKA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAcO,eAAe,EAAiB,CAAa,CAAE,CAAgB,EAClE,GAAI,CAKA,GAAI,CAFiB,AAEhB,CAHkC,MAAM,CAAA,EAAA,EAAA,EAG1B,wBAH0B,AAA0B,EAAC,EAAA,IAAI,CAAE,EAAO,EAAA,EACjD,IAAI,CAIpC,OADA,QAAQ,GAAG,CAAC,kCACL,KAIX,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,mBAAA,AAAmB,EACzC,EAAA,WAAW,CAAC,KAAK,CACjB,QACA,GAGJ,GAAI,CAAC,EAED,OADA,IADc,IACN,GAAG,CAAC,uCACL,KAIX,MAAO,CACH,GAAI,EAAY,EAAE,CAClB,MAAO,EAAY,KAAK,CACxB,KAAM,EAAY,IAAI,CACtB,KAAM,EAAY,IAAI,CACtB,OAAQ,EAAY,MAAM,CAC1B,OAAQ,EAAY,MAAM,CAC1B,UAAW,EAAY,SAAS,AACpC,CAEJ,CAAE,MAAO,EAAY,CAEjB,OADA,QAAQ,KAAK,CAAC,wBAAyB,EAAM,IAAI,CAAE,EAAM,OAAO,EACzD,IACX,CACJ,CAOO,eAAe,EAAa,CAA8C,EAC7E,GAAI,CAQA,GANqB,CAMjB,KANuB,CAAA,EAAA,EAAA,IAMT,eANS,AAAmB,EAC1C,EAAA,WAAW,CAAC,KAAK,CACjB,QACA,EAAS,KAAK,EAId,MAAO,CAAE,MAAO,qBAAsB,EAU1C,IAAM,EAAe,CANkB,MAAM,CAAA,EAAA,EAAA,8BAA8B,AAA9B,EACzC,EAAA,IAAI,CACJ,EAAS,KAAK,CACd,EAAS,SAAQ,EAGe,IAAI,CAExC,GAAI,CAAC,EACD,MAAO,CAAE,KADM,CACC,gCAAiC,EAIrD,IAAM,EAAiB,CACnB,MAAO,EAAS,KAAK,CACrB,KAAM,EAAS,IAAI,EAAI,WACvB,KAAM,EAAS,IAAI,EAAI,UACvB,OAAQ,EAAS,MAAM,EAAI,CAAC,iCAAiC,EAAE,mBAAmB,EAAS,IAAI,EAAI,QAAQ,kBAAkB,CAAC,CAC9H,OAAQ,SACR,UAAW,IAAI,OAAO,WAAW,GACjC,IAAK,EAAS,GAAG,EAAI,GACrB,OAAQ,EAAS,MAAM,EAAI,EAAE,CAC7B,SAAU,EAAS,QAAQ,EAAI,EACnC,EASA,GAAI,CAAC,CANU,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,EAC/B,EAAA,WAAW,CAAC,KAAK,CACjB,EACA,EAAa,IAAG,EAGR,OAAO,CACf,CADiB,KACV,CAAE,MAAO,+BAAgC,EAGpD,MAAO,CACH,GAAI,EAAa,GAAG,CACpB,GAAG,CAAc,AACrB,CAEJ,CAAE,MAAO,EAAY,CAIjB,GAHA,QAAQ,KAAK,CAAC,sBAAuB,EAAM,IAAI,CAAE,EAAM,OAAO,EAG1D,AAAe,6BAA6B,GAAtC,IAAI,CACV,MAAO,CAAE,MAAO,sBAAuB,EACpC,GAAmB,sBAAsB,CAArC,EAAM,IAAI,CACjB,MAAO,CAAE,MAAO,uBAAwB,EACrC,GAAmB,sBAAsB,CAArC,EAAM,IAAI,CACjB,MAAO,CAAE,MAAO,sBAAuB,EAG3C,MAAO,CAAE,MAAO,uBAAwB,CAC5C,CACJ,0CAlHsB,EA6CA,IA7CA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MA6CA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,mFCnEtB,IAAA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA"}